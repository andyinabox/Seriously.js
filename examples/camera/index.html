<!DOCTYPE html>
<html>
<head>
	<title>Seriously.js Camera Demo</title>
</head>
<body>
	<!-- page content goes here -->

	<video id="source" width="320" height="240"></video>
	<canvas id="target" width="640" height="480"></canvas>

	<div>
		<input type="range" id="vignette-range" min="0" max="20" step="0.0001" value="1"/>
	</div>

	<script src="../../lib/html5slider.js"></script>
	<script src="../../seriously.js"></script>
	<script src="../../effects/seriously.vignette.js"></script>
	<script src="../../effects/seriously.hue-saturation.js"></script>
	<script src="../../effects/seriously.split.js"></script>
	<script>
	(function() {
		//main code goes here

		// declare our variables
		var seriously, // the main object that holds the entire composition
			video,
			source,
			vignette, // a vignette effect
			target; // a wrapper object for our target canvas

		// detect browser-prefixed getUserMedia
		navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;

		// detect browser-prefixed window.URL
		window.URL = window.URL || window.webkitURL || window.mozURL || window.msURL;

		// grab the video element
		video = document.getElementById('source');

		// grab the video stream
		if (navigator.getUserMedia) {
			navigator.getUserMedia(
				{video: true},
				// success callback
				function(stream){
					// check for firefox
					if (video.mozCaptureStream) {
						video.mozSrcObject = stream;
					} else {
						video.src = (window.URL && window.URL.createObjectURL( stream )) || stream;
					}
					video.play();
				}, 
				// error callback
				function(){
					console.log("An error occurred: [CODE " + error.code + "]");
				}
			);
		}

		seriously = new Seriously();

		source = seriously.source(video);
		target = seriously.target('#target');
		vignette = seriously.effect('vignette');

		vignette.amount = '#vignette-range';

		// // connect all our nodes in the right order
		vignette.source = source;
		target.source = vignette;
		
		seriously.go();

	}());
	</script>
</body>
</html>
